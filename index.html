<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="description" content="545在线，电子雷峰塔，随时补充塔能量！笙歌牌播放器，采用PWA技术，支持智能缓存本地播放，可完全断网使用，由琴梨梨驱动" />
  <link rel="canonical" href="https://545.qinlili.bid/" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#FADCBB">
  <link rel="icon" href="./icon.png">
  <link rel="apple-touch-icon" href="./icon.png">
  <meta name="apple-mobile-web-app-title" content="545在线">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>545在线</title>
</head>

<body style="text-align: center">
  <script>
    document.body.innerHTML = "初始化...";
    const sleep = delay => new Promise((resolve) => setTimeout(resolve, delay))
    const init = async () => {
      if (!navigator.serviceWorker) {
        document.body.innerHTML = "你的浏览器不支持Service Worker，你应该换个浏览器了";
        return;
      }
      if (navigator.serviceWorker && !navigator.serviceWorker.controller) {
        document.body.innerHTML = "加载Service Worker...";
        await (await fetch("./sw.js")).blob();
        document.body.innerHTML = "读取版本信息...";
        let versionJson = await (await fetch("../version.json?ForceNoCache=1")).json();
        if (versionJson.success) {
          document.body.innerHTML = `安装Service Worker...<br>安装成功后将自动刷新页面<br>版本号：` + versionJson.latest;
          await navigator.serviceWorker.register('./sw.js', { scope: '/' });
          await sleep(3000)
          document.location.reload();
        } else {
          document.body.innerHTML = "读取版本失败！";
        }
        return;
      }
      if (navigator.userAgent.indexOf("WOW64") > 1) {
        document.body.innerHTML = "你正在64位操作系统上使用32位浏览器!为了更快的访问速度请改用64位浏览器!"
        await sleep(3000)
      }
      document.body.innerHTML = "正在加载播放器...";
      location.href = "player.html";
    }
    init();
  </script>
</body>

</html>